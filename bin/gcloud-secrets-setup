#!/bin/bash

gcloud kms keyrings create runtime-secrets --location global --project poutineer &&
gcloud kms keys create RAILS_MASTER_KEY --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys create POSTGRES_SUPERUSER_PASSWORD --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys create POSTGRES_APPLICATION_PASSWORD --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys create POSTGRES_SENTRY_PASSWORD --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys create POSTGRES_METABASE_PASSWORD --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys create POSTGRES_PGBOUNCER_PASSWORD --location global --keyring runtime-secrets --purpose encryption --project poutineer &&
gcloud kms keys add-iam-policy-binding RAILS_MASTER_KEY --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_SUPERUSER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_APPLICATION_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_SENTRY_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_METABASE_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_PGBOUNCER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:760958921243@cloudbuild.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding RAILS_MASTER_KEY --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_SUPERUSER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_APPLICATION_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_SENTRY_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_METABASE_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_PGBOUNCER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:service-760958921243@container-engine-robot.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding RAILS_MASTER_KEY --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer &&
gcloud kms keys add-iam-policy-binding POSTGRES_SUPERUSER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer
gcloud kms keys add-iam-policy-binding POSTGRES_APPLICATION_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer
gcloud kms keys add-iam-policy-binding POSTGRES_SENTRY_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer
gcloud kms keys add-iam-policy-binding POSTGRES_METABASE_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer
gcloud kms keys add-iam-policy-binding POSTGRES_PGBOUNCER_PASSWORD --location global --keyring runtime-secrets --member serviceAccount:docker-for-desktop@poutineer.iam.gserviceaccount.com --role roles/cloudkms.cryptoKeyEncrypterDecrypter --project poutineer
